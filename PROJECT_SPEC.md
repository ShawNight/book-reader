# 项目名称：YueDu Flutter (YDF) - 开源阅读器

## 1. 项目愿景
开发一个功能强大的 Android/iOS 阅读 APP，核心特性是**支持导入本地 JSON 书源**。用户可以像使用知名的“阅读”APP一样，导入现有的书源库，实现“一次配置，到处阅读”。

## 2. 技术栈
*   **框架**：Flutter 3.19+ (Dart)
*   **状态管理**：Riverpod (推荐，轻量且高效)
*   **本地存储**：Isar (NoSQL，支持直接存储 Dart 对象，适合存储 JSON 书源数据) 或 Hive
*   **网络请求**：Dio (支持拦截器，方便处理书源的 Header)

## 3. 核心功能模块

### 3.1 书源模型 (BookSource Model)
必须严格兼容上传文档中的 JSON 结构。
*   **字段要求**：
    *   `bookSourceName` (书源名称)
    *   `bookSourceUrl` (书源地址)
    *   `ruleSearch` (搜索规则对象)
    *   `ruleBookInfo` (书籍信息规则)
    *   `ruleToc` (目录规则)
    *   `ruleContent` (内容规则)
    *   `searchUrl` (搜索地址模板)
    *   `customOrder` (排序)
*   **特殊处理**：JSON 中包含正则表达式（如 `"##字数：([^<]+)##$1###"`），需在 Dart 模型中定义为 `String` 类型，并在运行时动态解析。

### 3.2 书源管理 (Import & Parse)
*   **导入功能**：提供“导入”按钮，调用系统文件选择器，读取用户选择的 `.json` 文件。
*   **解析逻辑**：
    1.  读取 JSON Array。
    2.  将 JSON 对象映射为 Dart 的 `BookSource` 类。
    3.  批量保存到 Isar 数据库中。
*   **兼容性**：必须能解析上传文档中“御龙小说网”那种复杂的嵌套 JSON 结构（包含 ExploreUrl 字符串化 JSON）。

### 3.3 阅读器核心 (Web Scraper)
*   **动态规则引擎**：
    *   根据书源中的 `ruleSearch`，动态生成搜索 URL 并解析 HTML/JSON 结果。
    *   根据 `ruleContent` 中的 CSS Selector (如 `#chapterContent@p@html`) 或正则表达式，抓取真实小说内容。
*   **编码支持**：部分书源（如“无CP交流窝”）可能涉及 GBK 编码，网络层需支持自动或手动编码转换。

### 3.4 UI 界面
*   **书架页**：展示已导入书源中的书籍。
*   **阅读页**：支持翻页、夜间模式、字体大小调整、背景颜色。
*   **书源市场页**：简单的列表展示已加载的书源（用于验证导入功能）。

## 4. 代码规范
*   **语言**：Dart 3.x
*   **格式**：使用 `dart format` (默认 80 列宽)
*   **注释**：关键逻辑（特别是正则替换和 HTML 解析部分）必须有中文注释。

## 5. 开发策略
*   **先做模型**：先确保能完美解析上传的 `文本_bkwx.txt` 文件。
*   **渐进式开发**：先实现“导入 JSON -> 显示书源列表”，再实现“搜索 -> 阅读”。